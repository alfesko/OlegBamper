<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Выбор запчастей</title>
    <link rel="stylesheet" href="/public/styles.css">
    <link rel="icon" href="/car.ico" type="image/x-icon">
</head>
<body>
<div class="container">
    <h2>Выбор запчастей</h2>
    <form action="/search" method="get">
        <label for="brand">Марка:</label>
        <select id="brand" name="brand" onchange="populateModels()">
            <option value="">Выберите марку</option>
        </select>
        <label for="year">Год выпуска:</label>
        <select id="year" name="year">
        </select>
        <label for="model">Модель:</label>
        <select id="model" name="model" required onchange="populateYears()">
        </select>
        <label for="article">Артикул объявления:</label>
        <input type="text" id="article" name="article" required>
        <label for="partNumber">Номер запчасти:</label>
        <input type="text" id="partNumber" name="partNumber" required>
        <button type="submit">Поиск</button>
    </form>
</div>

<button class="logout-btn" onclick="location.href='/logout';">Выйти</button>

<script>
    function populateModels() {
        const brandSelect = document.getElementById('brand');
        const modelSelect = document.getElementById('model');
        modelSelect.innerHTML = '';

        fetch('/cars.json')
            .then(response => response.json())
            .then(data => {
                const selectedBrand = brandSelect.value;

                const selectedBrandObj = data.find(brand => brand.id === selectedBrand);

                selectedBrandObj.models.forEach(model => {
                    const option = document.createElement('option');
                    option.value = model.id;
                    option.textContent = model.name;
                    modelSelect.appendChild(option);
                });

                // Populate years based on selected model
                populateYears();
            })
            .catch(error => console.error('Ошибка при загрузке данных:', error));
    }

    function populateYears() {
        const brandSelect = document.getElementById('brand');
        const modelSelect = document.getElementById('model');
        const yearSelect = document.getElementById('year');
        yearSelect.innerHTML = '';

        fetch('/cars.json')
            .then(response => response.json())
            .then(data => {
                const selectedBrand = brandSelect.value;
                const selectedBrandObj = data.find(brand => brand.id === selectedBrand);

                const selectedModelId = modelSelect.value;
                const selectedModel = selectedBrandObj.models.find(model => model.id === selectedModelId);

                // Populate years starting from selected model's year-from to 2024
                for (let year = selectedModel['year-from']; year <= 2024; year++) {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    yearSelect.appendChild(option);
                }
            })
            .catch(error => console.error('Ошибка при загрузке данных:', error));
    }

    fetch('/cars.json')
        .then(response => response.json())
        .then(data => {
            const brandSelect = document.getElementById('brand');

            data.forEach(brand => {
                const option = document.createElement('option');
                option.value = brand.id;
                option.textContent = brand.name;
                brandSelect.appendChild(option);
            });
        })
        .catch(error => console.error('Ошибка при загрузке данных:', error));

    // Initial population of year select
    const yearSelect = document.getElementById('year');
    for (let year = 1908; year <= 2024; year++) {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = year;
        yearSelect.appendChild(option);
    }
</script>

</body>
</html>
